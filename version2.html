<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LÝ THUYẾT ĐỒ THỊ</title>
    <link rel="stylesheet" href="main.css">
    <script src="https://unpkg.com/cytoscape@3.22.0/dist/cytoscape.min.js"></script>
</head>

<body>
    <header>
        <h1>Graph</h1>
    </header>

    <div class="container">
        <div id="input-container">
            <div id="graphInfo">
                <label for="nodeCountInput">Số lượng đỉnh:</label>
                <input type="number" id="nodeCountInput" value="0" oninput="updateGraphInfo()">
                <br>
                <label for="edgeCountInput">Số lượng cung:</label>
                <input type="number" id="edgeCountInput" value="0" oninput="updateGraphInfo()">
            </div>
            <label for="graphInput">Nhập các cung:</label><br>
            <textarea id="graphInput" rows="8" cols="40" oninput="updateGraphInfo()"></textarea><br>

            <label for="graphType">Chọn loại đồ thị:</label>
            <select id="graphType">
                <option value="directed">Đồ thị có hướng</option>
                <option value="undirected">Đồ thị vô hướng</option>
            </select><br>

            <button onclick="generateGraph()">Tạo đồ thị</button>
            <button onclick="addNode()">Thêm đỉnh mới</button>

            <!-- Phần tử chứa các nút phóng to/thu nhỏ -->
            <!-- <div id="zoom-controls">
                <button id="zoomInBtn" class="zoom-btn">+</button>
                <button id="zoomOutBtn" class="zoom-btn">-</button>
            </div><br> --> <br>
            <br>

            <!-- Dropdown chọn phương thức duyệt -->
            <label for="traversalType">Chọn thuật toán duyệt:</label>
            <select id="traversalType">
                <option value="bfs">Duyệt BFS</option>
                <option value="dfs">Duyệt DFS</option>
            </select><br>
            <label for="startNodeInput">Nhập đỉnh bắt đầu:</label>
            <input type="number" id="startNodeInput" value="1" min="1"><br>
            <button onclick="performTraversal()">Duyệt</button>
        </div>
        
        <!-- Đồ thị -->
        <div id="cy" style="height: 500px"></div> 

        <!-- Thứ tự đã duyệt -->
        <div>
            <label>Thứ tự đã duyệt:</label>
            <div id="visitedOrder" style="background-color: #f0f0f0; padding: 5px; margin-top: 5px; min-height: 30px;"></div>
        </div>
    </div>

    <script>
        let cy = null;
        let nodeCount = 0;
        let edgeCount = 0;

        // Hàm thêm đỉnh mới
        function addNode() {
            nodeCount++;
            const newNode = {
                data: {
                    id: '' + nodeCount,  // Label đỉnh là số đỉnh
                    label: '' + nodeCount
                },
                position: {
                    x: Math.random() * 1000,  // Vị trí ngẫu nhiên
                    y: Math.random() * 600
                }
            };

            cy.add(newNode);
            document.getElementById('nodeCountInput').value = nodeCount;
            updateGraphInput();
        }

        function updateGraphInput() {
            const inputText = document.getElementById('graphInput').value.trim();
            const lines = inputText.split('\n');
            let newInputText = lines.join('\n');
            document.getElementById('graphInput').value = newInputText;
        }

        function updateGraphInfo() {
            const inputText = document.getElementById('graphInput').value.trim();
            const lines = inputText.split('\n');
            let currentMaxNode = 0;
            let edgeCount = lines.length;

            lines.forEach(line => {
                const edgeData = line.split(' ').map(Number);
                if (edgeData.length >= 2) {
                    const source = edgeData[0];
                    const target = edgeData[1];
                    currentMaxNode = Math.max(currentMaxNode, source, target);
                }
                else if (edgeData.length == 1) {
                    currentMaxNode = Math.max(currentMaxNode, edgeData);
                }
            });

            nodeCount = currentMaxNode;
            edgeCount = edgeCount;
            document.getElementById('nodeCountInput').value = nodeCount;
            document.getElementById('edgeCountInput').value = edgeCount;
        }

        function generateGraph() {
            const inputText = document.getElementById('graphInput').value.trim();
            const lines = inputText.split('\n');
            const graphType = document.getElementById('graphType').value;

            let nodes = [];
            for (let i = 1; i <= nodeCount; i++) {
                nodes.push({
                    data: {
                        id: '' + i,
                        label: '' + i
                    }
                });
            }

            let edges = [];
            let edgeOccurrences = {};
            let nodePositions = {};

            if (lines.length === 0 && nodeCount > 0) {
                lines.push('');
            }

            lines.forEach(line => {
                const edgeData = line.split(' ').map(Number);
                if (edgeData.length >= 2) {
                    const source = edgeData[0];
                    const target = edgeData[1];
                    const weight = edgeData[2] || 0;

                    const edgeKey = source + '-' + target;
                    if (!edgeOccurrences[edgeKey]) {
                        edgeOccurrences[edgeKey] = 0;
                    }
                    edgeOccurrences[edgeKey]++;

                    let offsetX = 0, offsetY = 0;
                    if (edgeOccurrences[edgeKey] > 1) {
                        offsetX = (Math.random() - 0.5) * 50;
                        offsetY = (Math.random() - 0.5) * 50;
                    }

                    const edge = {
                        data: {
                            source: '' + source,
                            target: '' + target,
                            weight: weight ? String(weight) : ''
                        },
                        style: {
                            'line-color': '#000',
                            'target-arrow-color': '#000',
                            'width': 2,
                            'line-style': 'bezier',
                            'label': weight ? String(weight) : '',
                            'text-background-color': '#fff',
                            'text-background-opacity': 1,
                            'text-border-width': 1,
                            'text-border-color': '#000',
                            'target-arrow-shape': graphType === 'directed' ? 'triangle' : 'none'
                        },
                        position: {
                            x: offsetX,
                            y: offsetY
                        }
                    };
                    edges.push(edge);
                }
            });

            cy = cytoscape({
                container: document.getElementById('cy'),
                elements: nodes.concat(edges),
                style: [
                    {
                        selector: 'node',
                        style: {
                            'background-color': '#000',
                            'label': 'data(label)',
                            'color': '#fff',
                            'font-size': '15px',
                            'text-valign': 'center',
                            'text-halign': 'center'
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'width': 2,
                            'line-color': '#000',
                            'target-arrow-color': '#000',
                            'label': 'data(weight)',
                            'target-arrow-shape': 'triangle',
                            'curve-style': 'bezier',
                            'color': '#000',
                            'text-background-color': '#fff',
                            'text-background-opacity': 1,
                            'text-border-width': 1,
                            'text-border-color': '#000',
                            'font-size': '12px',
                            'text-margin-y': -12
                        }
                    }
                ],
                layout: {
                    name: 'grid',
                    rows: 3
                },
                ready: function () {
                    console.log('Graph is ready!');
                }
            });
        }

        // Hàm phóng to đồ thị
        function zoomIn() {
            const zoomLevel = cy.zoom();
            cy.zoom({ level: zoomLevel + 0.1 }); // Tăng mức độ zoom lên 0.1
        }

        // // Hàm thu nhỏ đồ thị
        // function zoomOut() {
        //     const zoomLevel = cy.zoom();
        //     cy.zoom({ level: zoomLevel - 0.1 }); // Giảm mức độ zoom xuống 0.1
        // }

        // // Gán sự kiện cho các nút
        // document.getElementById('zoomInBtn').addEventListener('click', zoomIn);
        // document.getElementById('zoomOutBtn').addEventListener('click', zoomOut);

    </script>
    <script src="bfs&dfs.js"></script>
</body>

</html>
